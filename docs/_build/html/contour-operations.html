

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Contour filters &mdash; vuba 0.1.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="HighGUI constructors" href="api-gui.html" />
    <link rel="prev" title="Creating masks" href="mask.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> vuba
          

          
          </a>

          
            
            
              <div class="version">
                0.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="why-vuba.html">Why vuba?</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basic-interfaces.html">Creating basic interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="reading-images.html">Reading images</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing-images.html">Writing images</a></li>
<li class="toctree-l1"><a class="reference internal" href="mask.html">Creating masks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contour filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-filters">Basic filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complex-filters">Complex filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api-gui.html">HighGUI constructors</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-io.html">Image IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-ops.html">Image operations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">vuba</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Contour filters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/contour-operations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="contour-filters">
<h1>Contour filters<a class="headerlink" href="#contour-filters" title="Permalink to this headline">¶</a></h1>
<p>Many image analysis workflows contain methods that extract shapes that satisfy specific critera. These criteria can be simply based on the corresponding areas of the shapes, through to more complex characteristics such as their associated solidity and eccentricity.</p>
<p>vuba provides a series of contour filters that allow one to extract contour shapes that satisfy some of the aforementioned criteria. These can be serially combined to allow the combination of a variety of criteria and also come built-in with pre-defined limits for more fine-scale tuning.</p>
<p>Here, we will cover the basic filters first followed by the more complex filters that are dependent on additional parameters.</p>
<div class="section" id="basic-filters">
<h2>Basic filters<a class="headerlink" href="#basic-filters" title="Permalink to this headline">¶</a></h2>
<p>The basic filters that vuba provides are currently limited to the following: <a class="reference internal" href="generated/vuba.smallest.html#vuba.smallest" title="vuba.smallest"><code class="xref py py-func docutils literal notranslate"><span class="pre">smallest()</span></code></a>, <a class="reference internal" href="generated/vuba.largest.html#vuba.largest" title="vuba.largest"><code class="xref py py-func docutils literal notranslate"><span class="pre">largest()</span></code></a> and <a class="reference internal" href="generated/vuba.parents.html#vuba.parents" title="vuba.parents"><code class="xref py py-func docutils literal notranslate"><span class="pre">parents()</span></code></a>.</p>
<p>To demonstrate their usage, we need to first generate some contours to filter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vuba</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Create a handler for the reading from the video</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">Video</span><span class="p">(</span><span class="s1">&#39;../examples/example_data/raw_video/test.avi&#39;</span><span class="p">)</span>

<span class="c1"># Read in the first frame and grayscale it</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">grayscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Threshold the grayscaled frame to a binary threshold (n=50, to=255)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>

<span class="c1"># Find all the contours in the thresholded image</span>
<span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">find_contours</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code has consisted of importing the first frame of the supplied example video and grayscaling it. We then applied a binary threshold to it with a threshold of 50. Note that the threshold applied here is arbitrary and only serves to enable us to generate a variety of shapes. Lastly, we applied contour detection to the thresholded image to generate arrays describing both the coordinates associated with each shape, but also their hierarchial information relative to the other shapes in the image.</p>
<p>Now that we have our contours, we can apply our contour filters and visualise the results!</p>
<p>We can retrieve the smallest contour (by area):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">smallest</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">smallest</span><span class="p">(</span><span class="n">contours</span><span class="p">)</span>
</pre></div>
</div>
<p>but also the largest contour (also by area):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">largest</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">largest</span><span class="p">(</span><span class="n">contours</span><span class="p">)</span>
</pre></div>
</div>
<p>and finally retrieve all parent contours:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parents</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">parents</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that here we needed to supply the hierarchical information in addition. This is because <a class="reference internal" href="generated/vuba.parents.html#vuba.parents" title="vuba.parents"><code class="xref py py-func docutils literal notranslate"><span class="pre">parents()</span></code></a> retrieves all the contours which are not a child of a larger contour. This can be useful for removing nested contours for example.</p>
<p>To visualise the results, we now need draw the results on blank canvases and stitch them together.</p>
<p>First we need to generate the canvases:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">bgr</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">all_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">all_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">all_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that we needed to convert the grayscale frame back to BGR format to enable us to draw coloured shapes. Next we can draw our contours on each of these canvases:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vuba</span><span class="o">.</span><span class="n">draw_contours</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">parents</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">vuba</span><span class="o">.</span><span class="n">draw_contours</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">largest</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">vuba</span><span class="o">.</span><span class="n">draw_contours</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">smallest</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">vuba</span><span class="o">.</span><span class="n">draw_contours</span><span class="p">(</span><span class="n">all_</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we can take advantage of the wrapper <a class="reference internal" href="generated/vuba.draw_contours.html#vuba.draw_contours" title="vuba.draw_contours"><code class="xref py py-func docutils literal notranslate"><span class="pre">draw_contours()</span></code></a> which accepts both lists and single numpy arrays. This avoids us having to write <code class="docutils literal notranslate"><span class="pre">for</span></code> loops for each list of contours. Finally, lets stitch our resultant images together and visualise them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stack the frames so we can view them all at once</span>
<span class="n">img1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">all_</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">img1</span><span class="p">,</span> <span class="n">img2</span><span class="p">))</span>

<span class="c1"># Resize the final image to a reasonable resolution</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">video</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

<span class="c1"># And display it</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;All contours/Parents/Largest/Smallest:&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">()</span>
</pre></div>
</div>
<p>This should give us an image that looks like the following:</p>
<ul class="simple">
<li><p>Add an asset here</p></li>
</ul>
</div>
<div class="section" id="complex-filters">
<h2>Complex filters<a class="headerlink" href="#complex-filters" title="Permalink to this headline">¶</a></h2>
<p>In addition to the basic contour filters mentioned above, vuba also supplies several more complex contour filters: <a class="reference internal" href="generated/vuba.Area.html#vuba.Area" title="vuba.Area"><code class="xref py py-class docutils literal notranslate"><span class="pre">Area</span></code></a>, <a class="reference internal" href="generated/vuba.Solidity.html#vuba.Solidity" title="vuba.Solidity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Solidity</span></code></a> and <a class="reference internal" href="generated/vuba.Eccentricity.html#vuba.Eccentricity" title="vuba.Eccentricity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Eccentricity</span></code></a>. Each of these filters permits additional fine-tuning via the use of pre-defined limits, supplied at initiation. This enables us to select specific characteristics for the types of shapes we’d like extracted from a previous set of images.</p>
<p>To demonstrate their usage, we will continue the script started above and add some additional filtering to retrieve small elliptical shapes.</p>
<p>First, let’s create our filters, we will need an area and eccentricity filter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initiate a relatively small area filter</span>
<span class="n">area_filter</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">Area</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="c1"># Initiate an eccentricity filter that filters anything out with an eccentricity value greater than 1</span>
<span class="n">circle_filter</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">Eccentricity</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have our filters, we can apply them to the contours we created above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Serially combine the filters to extract our shapes</span>
<span class="n">small_elliptical</span> <span class="o">=</span> <span class="n">area_filter</span><span class="p">(</span><span class="n">circle_filter</span><span class="p">(</span><span class="n">contours</span><span class="p">))</span>
</pre></div>
</div>
<p>Finally, let’s visualise our results to see what we extracted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw the shapes on the frame used previously (note the format conversion)</span>
<span class="n">elliptical_img</span> <span class="o">=</span> <span class="n">vuba</span><span class="o">.</span><span class="n">bgr</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
<span class="n">vuba</span><span class="o">.</span><span class="n">draw_contours</span><span class="p">(</span><span class="n">elliptical_img</span><span class="p">,</span> <span class="n">small_circles</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># And display the output</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;Small elliptical shapes&#39;</span><span class="p">,</span> <span class="n">elliptical_img</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">()</span>
</pre></div>
</div>
<p>This should give us an image that looks like the following:</p>
<ul class="simple">
<li><p>Add image</p></li>
</ul>
<p>Now, these aren’t much but hopefully show you how you can combine some more complex contour filters to select shapes that satisfy specific criteria.</p>
</div>
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>For additional example scripts that cover these filters in more complex applications see the following:</p>
<ul class="simple">
<li><p>examples/image_operations/contour_filters.py</p></li>
<li><p>exampes/image_operations/contours_filter_with_gui.py</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api-gui.html" class="btn btn-neutral float-right" title="HighGUI constructors" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mask.html" class="btn btn-neutral float-left" title="Creating masks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020-2021, Vuba

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>